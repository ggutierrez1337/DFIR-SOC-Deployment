# 4.0. Dashboard and Alert Creation for Mythic C2 Telemetry

# Mythic Telemetry

4.0. In Elasticsearch select **Discover** and **New** 

4.1. Query the name of the executable that was downloaded to the Windows Server - e.g. **svchost-dfir.exe**

4.2. Filter the timestamp from **Old to New** 

![Screenshot (954).png](Screenshot_(954).png)

4.3. Expand the first event pertaining to the svchost-dfir.exe. It can be seen that this was a **File Created** event with the event.code of **11** generated by sysmon

![Screenshot (955).png](Screenshot_(955).png)

4.4. Change the query to include event.code **1** which is the code for process creation

```powershell
svchost-dfir.exe and event.code: 1 
```

![Screenshot (956).png](Screenshot_(956).png)

4.5. When the event is expanded, we can see that this is process creation as well as the hashes for this process

![Screenshot (957).png](Screenshot_(957).png)

![Screenshot (958).png](Screenshot_(958).png)

4.6. Using the SHA1 hash, it can be ran in Virustotal to see if there is any hits pertaining to this hash. As it can be seen, there isn’t any 

![Screenshot (959).png](Screenshot_(959).png)

4.7. Checking the event Document again, an interesting field is **winlog.event_data.OriginalFileName.** It states that this executable’s original file name was **Apollo.exe,** but the current process name is **svchost-dfir.exe**

![Screenshot (960).png](Screenshot_(960).png)

## Alert Creation Pertaining to Apollo.exe Process

4.8. In order to create an alert that will detect if a process with the original name of **Apollo.exe** is ran along with its SHA256 hash, the two main fields required are: **winlog.event_data.OriginalFileName** and **winlog.event_data.Hashes**

4.9. Build out the alert detecting telemetry pertaining to the previous steps

```powershell
svchost-dfir.exe and event.code:1 and (winlog.event_data.Hashes *SHA256 HASH* or winlog.event_data.OriginalFileName: Apollo.exe)
```

![Screenshot (961).png](Screenshot_(961).png)

4.1.0. To check for events only pertaining to **Process Creation** for **Apollo.exe** and its hash, remove the name of the executable as it also generates other information as well, where in this case the goal is only Process Creation

```powershell
event.code:1 and (winlog.event_data.Hashes *SHA256 HASH* or winlog.event_data.OriginalFileName: Apollo.exe)
```

4.2.0. Save the query and save the search to a notepad

## Rule Creation

4.2.1. In **Security → Detection & Rules,** create a new rule. Rule type should be kept as **Custom Query** and then paste the query under **Custom Query** field

![Screenshot (962).png](Screenshot_(962).png)

4.2.3. Add **Required Fields:** timestamp, host.hostname, message, winlog.event_data.ParentCommandLine, winlog.event_data.ParentImage, winlog.event_data.CommandLine, winlog.event_data.Image, winlog.event_data.ProcessGuid, winlog.event_data.User

![Screenshot (963).png](Screenshot_(963).png)

4.2.4. Once everything has been added, name the rule, then **Create & Enable Rule**

![Screenshot (964).png](Screenshot_(964).png)

## Dashboard Creation

The following Dashboards will be created pertaining to this telemetry

- Event ID 3 - Network Connections (External) any processes **initiating** a network connection outbound

```powershell
event.code: 3 and event.provider: Microsoft-Windows-Sysmon and winlog.event_data.Initiated: true 
```

- Event ID 1 - Process Creation - powershell, cmd, rundll32

```powershell
event.code: 1 and event.provider: Microsoft-Windows-Sysmon and (powershell or cmd or rundll32)
```

- Event ID: 5001

```powershell
event.code: 5001 and event.provider: Microsoft-Windows-Windows Defender
```

4.2.6. Once the queries have been made for each of the specific events being sought after, go to **Dashboards** and create a new Dashboard Visualization

4.2.7. Copy and paste the query into the query field, and the main **Fields** of interest for Event Code 1 are the following: timestamp, winlog.event_data.CurrentDirectory, winlog.event_data.ParentCommandLine, winlog.event_data.ParentImage, winlog.event_data.CommandLine, winlog.event_data.Image, winlog.event_data.ProcessGuid, winlog.event_data.User

![Screenshot (966).png](Screenshot_(966).png)

4.2.8. Format the table to the desired liking and save the Dashboard

![Screenshot (967).png](Screenshot_(967).png)

4.2.9. Select **Create visualization** again to create a dashboard for **Event ID 3**. Copy and Paste the query for Event ID 3 into the query section

4.3.0. Some fields of interest will be:  winlog.event_data.Image, winlog.event_data.DestinationIp, winlog.event_data.SourceIp, winlog.event_data.DestinationPort

4.3.1. Drag and Drop the fields in the middle section to begin pulling the data for those specific fields. Ensure the type of dashboard is a **table.** Make appropriate modifications regarding the fields then save the dashboard

![Screenshot (968).png](Screenshot_(968).png)

4.3.2. Next, create a dashboard for **Event Code 5001.** The fields of interest include only **host.hostname, winlog.event_data.ProductName,** and **event.code**

4.3.3. Make any necessary changes then save the dashboard 

![Screenshot (969).png](Screenshot_(969).png)

![Screenshot_(954).png](Screenshot_(954)%201.png)
