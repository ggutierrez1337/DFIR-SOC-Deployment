# 4.0. Dashboard and Alert Creation for Mythic C2 Telemetry

# Mythic Telemetry

4.0. In Elasticsearch select **Discover** and **New** 

4.1. Query the name of the executable that was downloaded to the Windows Server - e.g. **svchost-dfir.exe**

4.2. Filter the timestamp from **Old to New** 

![Uploading Screenshot_(954).png…]()

4.3. Expand the first event pertaining to the svchost-dfir.exe. It can be seen that this was a **File Created** event with the event.code of **11** generated by sysmon

![Screenshot (955).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/a4bdd500-e64c-402b-96c3-a16a27e6ad06/Screenshot_(955).png)

4.4. Change the query to include event.code **1** which is the code for process creation

```powershell
svchost-dfir.exe and event.code: 1 
```

![Screenshot (956).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/f59370e3-2fa1-43f4-b2c8-89492efd4f3d/Screenshot_(956).png)

4.5. When the event is expanded, we can see that this is process creation as well as the hashes for this process

![Screenshot (957).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/de7fa21e-1afe-4267-94a0-13d340c8183d/Screenshot_(957).png)

![Screenshot (958).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/a6880333-c8e6-405f-b044-09895feaea61/Screenshot_(958).png)

4.6. Using the SHA1 hash, it can be ran in Virustotal to see if there is any hits pertaining to this hash. As it can be seen, there isn’t any 

![Screenshot (959).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/31370ab8-fe0f-42d4-bff1-68b5fcd8d6f0/Screenshot_(959).png)

4.7. Checking the event Document again, an interesting field is **winlog.event_data.OriginalFileName.** It states that this executable’s original file name was **Apollo.exe,** but the current process name is **svchost-dfir.exe**

![Screenshot (960).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/c28f76d3-61c6-4a25-abdc-b4c858cf9bc5/Screenshot_(960).png)

## Alert Creation Pertaining to Apollo.exe Process

4.8. In order to create an alert that will detect if a process with the original name of **Apollo.exe** is ran along with its SHA256 hash, the two main fields required are: **winlog.event_data.OriginalFileName** and **winlog.event_data.Hashes**

4.9. Build out the alert detecting telemetry pertaining to the previous steps

```powershell
svchost-dfir.exe and event.code:1 and (winlog.event_data.Hashes *SHA256 HASH* or winlog.event_data.OriginalFileName: Apollo.exe)
```

![Screenshot (961).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/c965852f-4ebf-40af-8594-cfb4b1617c0f/Screenshot_(961).png)

4.1.0. To check for events only pertaining to **Process Creation** for **Apollo.exe** and its hash, remove the name of the executable as it also generates other information as well, where in this case the goal is only Process Creation

```powershell
event.code:1 and (winlog.event_data.Hashes *SHA256 HASH* or winlog.event_data.OriginalFileName: Apollo.exe)
```

4.2.0. Save the query and save the search to a notepad

## Rule Creation

4.2.1. In **Security → Detection & Rules,** create a new rule. Rule type should be kept as **Custom Query** and then paste the query under **Custom Query** field

![Screenshot (962).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/e48ba7ad-9ba4-444c-bd47-677150e09ad0/Screenshot_(962).png)

4.2.3. Add **Required Fields:** timestamp, host.hostname, message, winlog.event_data.ParentCommandLine, winlog.event_data.ParentImage, winlog.event_data.CommandLine, winlog.event_data.Image, winlog.event_data.ProcessGuid, winlog.event_data.User

![Screenshot (963).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/aafc471d-4566-4d87-adb4-91fe338faba0/Screenshot_(963).png)

4.2.4. Once everything has been added, name the rule, then **Create & Enable Rule**

![Screenshot (964).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/67bbcc4e-12f7-4d3d-a3c0-fc9e632a33e9/Screenshot_(964).png)

## Dashboard Creation

The following Dashboards will be created pertaining to this telemetry

- Event ID 3 - Network Connections (External) any processes **initiating** a network connection outbound

```powershell
event.code: 3 and event.provider: Microsoft-Windows-Sysmon and winlog.event_data.Initiated: true 
```

- Event ID 1 - Process Creation - powershell, cmd, rundll32

```powershell
event.code: 1 and event.provider: Microsoft-Windows-Sysmon and (powershell or cmd or rundll32)
```

- Event ID: 5001

```powershell
event.code: 5001 and event.provider: Microsoft-Windows-Windows Defender
```

4.2.6. Once the queries have been made for each of the specific events being sought after, go to **Dashboards** and create a new Dashboard Visualization

4.2.7. Copy and paste the query into the query field, and the main **Fields** of interest for Event Code 1 are the following: timestamp, winlog.event_data.CurrentDirectory, winlog.event_data.ParentCommandLine, winlog.event_data.ParentImage, winlog.event_data.CommandLine, winlog.event_data.Image, winlog.event_data.ProcessGuid, winlog.event_data.User

![Screenshot (966).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/8d036613-e5cc-45c2-9e97-8313bbf1da3f/Screenshot_(966).png)

4.2.8. Format the table to the desired liking and save the Dashboard

![Screenshot (967).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/3a27d53a-f050-4025-bb80-609474e3b9a2/Screenshot_(967).png)

4.2.9. Select **Create visualization** again to create a dashboard for **Event ID 3**. Copy and Paste the query for Event ID 3 into the query section

4.3.0. Some fields of interest will be:  winlog.event_data.Image, winlog.event_data.DestinationIp, winlog.event_data.SourceIp, winlog.event_data.DestinationPort

4.3.1. Drag and Drop the fields in the middle section to begin pulling the data for those specific fields. Ensure the type of dashboard is a **table.** Make appropriate modifications regarding the fields then save the dashboard

![Screenshot (968).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/a9ac2a8e-ad14-47fb-b0d4-03525660f2b8/Screenshot_(968).png)

4.3.2. Next, create a dashboard for **Event Code 5001.** The fields of interest include only **host.hostname, winlog.event_data.ProductName,** and **event.code**

4.3.3. Make any necessary changes then save the dashboard 

![Screenshot (969).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/246692bd-cf92-4f91-8b4e-6d4c15c8bf7a/be2cc920-0bdf-429e-bd27-50f5dea9d491/Screenshot_(969).png)

![Screenshot_(954).png](attachment:4d15be8b-6681-4446-91b2-6859539fb10d:Screenshot_(954).png)
